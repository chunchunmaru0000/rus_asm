#влечь (
	"база.ср"
	"вывод_ошибок.ср"
)

лик Лексер (
	ист: лик Исток
	место_в_файле: ц64
)
; Общий Лексер
пусть ол: лик Лексер = 0,

фц новый_лексер(из находясь_в: стр) лик Лексер (
	лек есть лик Лексер = пновый лик Лексер,
	ист есть лик Исток  = пновый лик Исток,
	вфе есть лик ВФайле = пновый лик ВФайле,

	лек->ист = ист,
	лек->место_в_файле = 0,

	ист->в_файле = вфе,
	ист->строчка = 1,
	ист->буква = 1,

	вфе->путь = из,
	(вфе->текст, вфе->длина) = читатьфп(из),
	вфе->длина--,

	вфе->текст == 0 ?? (
		вещать..(ЦК, "ОШИБКА В ОТКРЫТИИ ФАЙЛА ", из, "\n" ЦН),
		выйти с кодом 1 .
		; во("ОШИБКА В ОТКРЫТИИ ФАЙЛА", ист),
	)
	вещать..(
		"ТЕКСТ [", вфе->путь, "] длиной [", вфе->длина, "]:\n",
		" ############################\n",
		вфе->текст,
		"\n ############################\n"
	),

	воздать лек,
)

фц от_щасл(от: ч32) ц8 (
	воздать ол->место_в_файле + от < ол->ист->в_файле->длина
		? ол->ист->в_файле->текст[ол->место_в_файле + от]
		: 0,
)
фц __АСМ щасл() ц8 (
	воздать ол->место_в_файле < ол->ист->в_файле->длина
		? ол->ист->в_файле->текст[ол->место_в_файле]
		: 0,
)
фц __АСМ следл() тлен (
	ол->место_в_файле++,
	ол->ист->строчка++,
)
фц след_строкал(лек: лик Лексема) счет ЛРод (
	следл(),
	ол->ист->буква = 1,
	ол->ист->строчка++,
	лек->вид = ПУСТАЯ_СТРОКА,
	воздать ЛРод.Черта,
)

фц разобрать_на_лексемы(из находясь_в: стр) лик ПРяд (
	ол = новый_лексер(из, находясь_в),
	р есть лик ПРяд = новый_пряд(1024, 8),
	воздать р,
)
